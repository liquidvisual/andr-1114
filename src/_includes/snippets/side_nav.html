{% comment %}
<!--
    Updated: 09.12.14

    - Notes -

    When 'side_nav_id' is passed, data is pulled from requested node in /data/sitemap.yml creating second level nav.
    Optional: 'exclude_top_level' can be passed through the include, skipping the top level of the side nav.

    Basic Output:

        <ul>
            <li class="active"><a href="/">Home</a></li>
            <li class="nested"><a href="/some-link/"> - Some Link</a></li>
            <li class="nested"><a href="/some-link/"> - Some Link</a></li>
            <li class="nested"><a href="/some-link/"> - Some Link</a></li>
        </ul>
-->
{% endcomment %}

{% assign sitemap = site.data.sitemap %}
{% assign top_level_id = page.side_nav_top_level_id %}
{% assign top_level_node = sitemap[top_level_id] %}
{% assign exclude_top_level = include.exclude_top_level %}

{% if top_level_id %}

    <ul class="side-nav">

        {% comment %} TOP LEVEL (Optional) {% endcomment %}
        {% unless exclude_top_level %}
        <li class="{% if top_level_node.url == page.url %} active {% endif %}">
            <a href="{{ top_level_node.url }}">{{ top_level_node.title }}</a>
        </li>
        {% endunless %}

        {% comment %} SECOND LEVEL {% endcomment %}
        {% for item in top_level_node.children %}
        <li class="{% if item.url == page.url %} active {% endif %}">
            <a href="{{ item.url }}"> {{ item.title }}</a>

            {% comment %} THIRD LEVEL {% endcomment %}
            {% if item.children and item.url == page.url %}
            <ul class="no-bullet">
                {% for item in item.children %}
                    <li class="{% include snippets/is_active.html current_path="news" %}">
                        <a href="{{ item.url }}">- {{ item.title }}</a>
                    </li>
                {% endfor %}
            </ul>
            {% endif %}

        </li>
        {% endfor %}

    </ul>
{% endif %}